---
title: "Pacific Maritime Big Book of Bees"
bibliography: references.bib
csl: vancouver.csl
---

Created and designed by Cait Harrigan & Kath Quayle

```{r include = F}
knitr::opts_chunk$set(echo = F, warning=F, message=F)
options(knitr.kable.NA = '')

library(plotly)
library(tidyverse)
library(kableExtra)
library(googlesheets4)
source('generate_pages.R')

```

# Big Book of Bees!

Our Big Book of Bees features a gallery of `r nrow(df)` wild bee species that have been documented in BC’s Pacific Maritime region at one time or another between 1854 and Apr 2024. The gallery is based on a new annotated catalogue ([reference list](/references.html)) of native bees in this region, aka the “Best List” (Quayle, Zand and Best, 2024, manuscript in preparation). This catalogue updates the information in the checklist published by [Sheffield and Heron in 2018](https://journal.entsocbc.ca/index.php/journal/article/view/1001). It includes new findings since 2018 in published literature, [iNaturalist](https://www.inaturalist.org/) (research grade), [GBIF](https://www.gbif.org/), the [BC Bee Atlas Database](https://www.bcnativebees.org/bc-bee-atlas), and the [Galiano Biodiversity Life List](https://biogaliano.org/taxa/). 

Images have been collected from iNaturalist as well as from the [Spencer Entomological Collection (SEC)](https://www.zoology.ubc.ca/entomology/), to whom we give special thanks for allowing us to reproduce their specimen images for this book.


We indicate some attributes with the following badges:

|                  Badge                  | Meaning                                                                                               |
|:------------------------------:|----------------------------------------|
| [Lower Mainland]{.lower-mainland-badge} | Species present in the lower mainland south of Squamish: Metro Vancouver, Fraser Valley               |
|          [Coast]{.coast-badge}          | Central coast and Northwest: Islands and mainland coast north of Squamish, excluding Vancouver Island |
|    [Vancouver Island]{.vanc-isl-badge}    | Species present on Vancouver Island, or Southern Gulf Islands                                         |
|         [Galiano]{.gali-badge}          | Species present on Galiano Island                                                                     |

: {tbl-colwidths="\[25,75\]"}

# Why we made this book

We made this book to provide easy access to information that can help you identify native bees that have been found in BC’s Pacific Maritime region. The photo gallery lets you compare your bee picture or specimen to species known to be in the region, and links to GBIF and iNaturalist maps show you where and when different species have been observed.

We focus on the Pacific Maritime region, and link out to records of the same species if they've been spotted elsewhere in the world. Our goal is not to duplicate functionality of well-established aggregators, but to provide different options for organizing and visualizing the same data.

::: {.callout-note icon="false"}
# Feedback

If you find this resource useful we'd love to hear about it! Let us know using our [survey page](https://forms.gle/WQtfTvAeJDGKkrP37). Any comments and feedback re missing bees, incorrect entries, etc. are also much appreciated!
:::

Example usage:

-   Select a species in the gallery
-   Check out the GBIF (Global Biodiversity Information Facility) map where available
-   Compare with your own observations to help identify bees

The species pages are set up to help answer "When was this species last seen in the Pacific Maritime?"

<center><a href="gallery.html"><button type="button" class="btn btn-secondary">Take me to the bees! <i class="fa-solid fa-arrow-right"></i> </button></a></center>

# Ecozones of British Columbia

This resource focuses on the Pacific Maritime ecozone in BC, Canada. For the exact polygon definition we used for this ecozone, see the GBIF data DOI link below.

![Modified from Cannings 2016 @cannings2016ecozones to include the boundary of the Western Interior Basin (WIB), which is comparable to the Southern Interior ecoprovince of BC’s Ecoregion Classification System @demarchi2011introduction.](files/ecozones.png){width="60%" float="center" fig_alt="Map of BC shaded to show ecozones. Pacific maritime is highlighted on the west coast of BC, Canada"}


See the [Ecozones Framework of Canada](http://www.ecozones.ca) for more information.

# Bee families in the Pacific Maritime

These maps show observations from GBIF for bee families in the Pacific Maritime. Double click any genus to isolate it on the map. 37 historical datasets are represented in our GBIF data, [downloaded December 27th 2023](https://doi.org/10.15468/dl.vtr55y).

```{r}
map_plot <- function(df){
  df %>%
    filter(!is.na(Species))%>%
    mutate(Year=ifelse(Year<2015, 'Before 2015', Year)) %>%
  mutate(Year = ordered(Year, levels = c('Before 2015', 2015:2023))) %>%
  complete(Year, Genus) %>%
  plot_ly() %>%
  add_trace(
    lat = ~lat, lon =~lon,
    mode = 'markers', type = 'scattermapbox',
    frame= ~Year,
    color = ~Genus,
    text = ~paste('Species:', Genus, Species, '\nObserved:', stamp("March 1, 1999")(date)),
    size=10,
    colors='Paired'
  ) %>%
  layout(mapbox = list(
    style = 'carto-positron', show_legend = T,
    #zoom=7, center = list(lon = -123, lat = 49)))
    zoom=3.5, center = list(lon = -127, lat = 52)),
    title = 'GBIF observations') %>%
    return()
}
```

::: panel-tabset
## Andrenidae

```{r}
gbif %>%
  filter(family == 'Andrenidae') %>%
  map_plot()
```

## Apidae

```{r}
gbif %>%
  filter(family == 'Apidae') %>%
  map_plot()
```

## Colletidae

```{r}
gbif %>%
  filter(family == 'Colletidae') %>%
  map_plot()
```

## Halictidae

```{r}
gbif %>%
  filter(family == 'Halictidae') %>%
  map_plot()
```

## Megachilidae

```{r}
gbif %>%
  filter(family == 'Megachilidae') %>%
  map_plot()
```

## Melittidae

```{r}
gbif %>%
  filter(family == 'Melittidae') %>%
  map_plot()
```
:::

# Data Completeness

Bee book gallery shows two pieces of information per species page:

1.  Bee image (curated by KQ)
2.  Map of observations in Pacific Maritime (pulled from GBIF)

Page completeness is as follows:

```{r}
upset_list = list(`Has PM map` = unique(gbif$Species),
                  `In bee gallery` = unique(df$Species), 
                  `Has image` = unique(df$Species[!is.na(df$`Image link`)])
)

UpSetR::upset(UpSetR::fromList(upset_list))

```

# Family coverage

```{r}
gbif %>%
  filter(!is.na(Species)) %>%
  group_by(family, Species) %>% 
  summarize(n()) %>%
  group_by(family) %>% 
  summarize(gbif=n()) %>%
  rename(Family=family) %>%
  merge(df %>%
    filter(!is.na(Species)) %>%
    group_by(Family) %>% 
    summarize(gallery=n())
  ) %>%
  pivot_longer(-c(Family)) %>%
  ggplot(aes(x = reorder(Family, value), y = value, fill=name)) + 
  geom_bar(stat='identity', position = 'dodge') +
  ggpubr::theme_pubr() +
  coord_flip() + 
  scale_fill_manual(values = c('#376D61', 'grey70'), labels = c("Bee Book", "GBIF")) + 
  labs(y = 'Count', x = 'Family', fill='Collection')

```

Last updated: `r now()`
